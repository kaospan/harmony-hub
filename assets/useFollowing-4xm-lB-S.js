import{c as fe,p as me,f as pe,r as f,h as he,j as m,i as C,g as k,P as V,k as ge,a as we,d as O,s as M}from"./index-BX1-5uJX.js";import{c as $}from"./index-BdQq_4o_.js";import{u as Se}from"./index-BiV5K_eQ.js";import{u as be}from"./index-B5wY23Ui.js";import{u as X}from"./useQuery-GHdTcwIr.js";import{u as ve}from"./useMutation-D6BUY7Ff.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=fe("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);var G=["PageUp","PageDown"],W=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Q={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},I="Slider",[F,ye,xe]=me(I),[J,$e]=pe(I,[xe]),[_e,B]=J(I),Z=f.forwardRef((e,t)=>{const{name:r,min:o=0,max:a=100,step:s=1,orientation:n="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:p=[o],value:h,onValueChange:i=()=>{},onValueCommit:u=()=>{},inverted:w=!1,form:x,...c}=e,S=f.useRef(new Set),g=f.useRef(0),v=n==="horizontal"?Pe:Re,[b=[],j]=he({prop:h,defaultProp:p,onChange:y=>{var E;(E=[...S.current][g.current])==null||E.focus(),i(y)}}),N=f.useRef(b);function T(y){const _=ke(b,y);A(y,_)}function de(y){A(y,g.current)}function ue(){const y=N.current[g.current];b[g.current]!==y&&u(b)}function A(y,_,{commit:E}={commit:!1}){const q=Ke(s),z=Ve(Math.round((y-o)/s)*s+o,q),K=$(z,[o,a]);j((D=[])=>{const P=Ce(D,K,_);if(Ae(P,d*s)){g.current=P.indexOf(K);const Y=String(P)!==String(D);return Y&&E&&u(P),Y?P:D}else return D})}return m.jsx(_e,{scope:e.__scopeSlider,name:r,disabled:l,min:o,max:a,valueIndexToChangeRef:g,thumbs:S.current,values:b,orientation:n,form:x,children:m.jsx(F.Provider,{scope:e.__scopeSlider,children:m.jsx(F.Slot,{scope:e.__scopeSlider,children:m.jsx(v,{"aria-disabled":l,"data-disabled":l?"":void 0,...c,ref:t,onPointerDown:C(c.onPointerDown,()=>{l||(N.current=b)}),min:o,max:a,inverted:w,onSlideStart:l?void 0:T,onSlideMove:l?void 0:de,onSlideEnd:l?void 0:ue,onHomeKeyDown:()=>!l&&A(o,0,{commit:!0}),onEndKeyDown:()=>!l&&A(a,b.length-1,{commit:!0}),onStepKeyDown:({event:y,direction:_})=>{if(!l){const z=G.includes(y.key)||y.shiftKey&&W.includes(y.key)?10:1,K=g.current,D=b[K],P=s*z*_;A(D+P,K,{commit:!0})}}})})})})});Z.displayName=I;var[ee,te]=J(I,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Pe=f.forwardRef((e,t)=>{const{min:r,max:o,dir:a,inverted:s,onSlideStart:n,onSlideMove:l,onSlideEnd:d,onStepKeyDown:p,...h}=e,[i,u]=f.useState(null),w=k(t,v=>u(v)),x=f.useRef(void 0),c=Se(a),S=c==="ltr",g=S&&!s||!S&&s;function R(v){const b=x.current||i.getBoundingClientRect(),j=[0,b.width],T=U(j,g?[r,o]:[o,r]);return x.current=b,T(v-b.left)}return m.jsx(ee,{scope:e.__scopeSlider,startEdge:g?"left":"right",endEdge:g?"right":"left",direction:g?1:-1,size:"width",children:m.jsx(re,{dir:c,"data-orientation":"horizontal",...h,ref:w,style:{...h.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:v=>{const b=R(v.clientX);n==null||n(b)},onSlideMove:v=>{const b=R(v.clientX);l==null||l(b)},onSlideEnd:()=>{x.current=void 0,d==null||d()},onStepKeyDown:v=>{const j=Q[g?"from-left":"from-right"].includes(v.key);p==null||p({event:v,direction:j?-1:1})}})})}),Re=f.forwardRef((e,t)=>{const{min:r,max:o,inverted:a,onSlideStart:s,onSlideMove:n,onSlideEnd:l,onStepKeyDown:d,...p}=e,h=f.useRef(null),i=k(t,h),u=f.useRef(void 0),w=!a;function x(c){const S=u.current||h.current.getBoundingClientRect(),g=[0,S.height],v=U(g,w?[o,r]:[r,o]);return u.current=S,v(c-S.top)}return m.jsx(ee,{scope:e.__scopeSlider,startEdge:w?"bottom":"top",endEdge:w?"top":"bottom",size:"height",direction:w?1:-1,children:m.jsx(re,{"data-orientation":"vertical",...p,ref:i,style:{...p.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:c=>{const S=x(c.clientY);s==null||s(S)},onSlideMove:c=>{const S=x(c.clientY);n==null||n(S)},onSlideEnd:()=>{u.current=void 0,l==null||l()},onStepKeyDown:c=>{const g=Q[w?"from-bottom":"from-top"].includes(c.key);d==null||d({event:c,direction:g?-1:1})}})})}),re=f.forwardRef((e,t)=>{const{__scopeSlider:r,onSlideStart:o,onSlideMove:a,onSlideEnd:s,onHomeKeyDown:n,onEndKeyDown:l,onStepKeyDown:d,...p}=e,h=B(I,r);return m.jsx(V.span,{...p,ref:t,onKeyDown:C(e.onKeyDown,i=>{i.key==="Home"?(n(i),i.preventDefault()):i.key==="End"?(l(i),i.preventDefault()):G.concat(W).includes(i.key)&&(d(i),i.preventDefault())}),onPointerDown:C(e.onPointerDown,i=>{const u=i.target;u.setPointerCapture(i.pointerId),i.preventDefault(),h.thumbs.has(u)?u.focus():o(i)}),onPointerMove:C(e.onPointerMove,i=>{i.target.hasPointerCapture(i.pointerId)&&a(i)}),onPointerUp:C(e.onPointerUp,i=>{const u=i.target;u.hasPointerCapture(i.pointerId)&&(u.releasePointerCapture(i.pointerId),s(i))})})}),oe="SliderTrack",ne=f.forwardRef((e,t)=>{const{__scopeSlider:r,...o}=e,a=B(oe,r);return m.jsx(V.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...o,ref:t})});ne.displayName=oe;var H="SliderRange",ie=f.forwardRef((e,t)=>{const{__scopeSlider:r,...o}=e,a=B(H,r),s=te(H,r),n=f.useRef(null),l=k(t,n),d=a.values.length,p=a.values.map(u=>le(u,a.min,a.max)),h=d>1?Math.min(...p):0,i=100-Math.max(...p);return m.jsx(V.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...o,ref:l,style:{...e.style,[s.startEdge]:h+"%",[s.endEdge]:i+"%"}})});ie.displayName=H;var L="SliderThumb",se=f.forwardRef((e,t)=>{const r=ye(e.__scopeSlider),[o,a]=f.useState(null),s=k(t,l=>a(l)),n=f.useMemo(()=>o?r().findIndex(l=>l.ref.current===o):-1,[r,o]);return m.jsx(Ee,{...e,ref:s,index:n})}),Ee=f.forwardRef((e,t)=>{const{__scopeSlider:r,index:o,name:a,...s}=e,n=B(L,r),l=te(L,r),[d,p]=f.useState(null),h=k(t,R=>p(R)),i=d?n.form||!!d.closest("form"):!0,u=ge(d),w=n.values[o],x=w===void 0?0:le(w,n.min,n.max),c=Me(o,n.values.length),S=u==null?void 0:u[l.size],g=S?Ie(S,x,l.direction):0;return f.useEffect(()=>{if(d)return n.thumbs.add(d),()=>{n.thumbs.delete(d)}},[d,n.thumbs]),m.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${x}% + ${g}px)`},children:[m.jsx(F.ItemSlot,{scope:e.__scopeSlider,children:m.jsx(V.span,{role:"slider","aria-label":e["aria-label"]||c,"aria-valuemin":n.min,"aria-valuenow":w,"aria-valuemax":n.max,"aria-orientation":n.orientation,"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,tabIndex:n.disabled?void 0:0,...s,ref:h,style:w===void 0?{display:"none"}:e.style,onFocus:C(e.onFocus,()=>{n.valueIndexToChangeRef.current=o})})}),i&&m.jsx(ae,{name:a??(n.name?n.name+(n.values.length>1?"[]":""):void 0),form:n.form,value:w},o)]})});se.displayName=L;var De="RadioBubbleInput",ae=f.forwardRef(({__scopeSlider:e,value:t,...r},o)=>{const a=f.useRef(null),s=k(a,o),n=be(t);return f.useEffect(()=>{const l=a.current;if(!l)return;const d=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(d,"value").set;if(n!==t&&h){const i=new Event("input",{bubbles:!0});h.call(l,t),l.dispatchEvent(i)}},[n,t]),m.jsx(V.input,{style:{display:"none"},...r,ref:s,defaultValue:t})});ae.displayName=De;function Ce(e=[],t,r){const o=[...e];return o[r]=t,o.sort((a,s)=>a-s)}function le(e,t,r){const s=100/(r-t)*(e-t);return $(s,[0,100])}function Me(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function ke(e,t){if(e.length===1)return 0;const r=e.map(a=>Math.abs(a-t)),o=Math.min(...r);return r.indexOf(o)}function Ie(e,t,r){const o=e/2,s=U([0,50],[0,o]);return(o-s(t)*r)*r}function je(e){return e.slice(0,-1).map((t,r)=>e[r+1]-t)}function Ae(e,t){if(t>0){const r=je(e);return Math.min(...r)>=t}return!0}function U(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(r-e[0])}}function Ke(e){return(String(e).split(".")[1]||"").length}function Ve(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}var ce=Z,Be=ne,Ne=ie,Te=se;const ze=f.forwardRef(({className:e,...t},r)=>m.jsxs(ce,{ref:r,className:we("relative flex w-full touch-none select-none items-center",e),...t,children:[m.jsx(Be,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:m.jsx(Ne,{className:"absolute h-full bg-primary"})}),m.jsx(Te,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ze.displayName=ce.displayName;function Xe(){const{user:e}=O();return X({queryKey:["following",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await M.from("user_follows").select("*").eq("follower_id",e.id);if(r)throw r;return t||[]},enabled:!!e})}function Ge(){const{user:e}=O();return ve({mutationFn:async({trackId:t,durationMs:r,source:o="feed"})=>{if(!e)throw new Error("Not authenticated");const{data:a,error:s}=await M.from("play_history").insert({user_id:e.id,track_id:t,duration_ms:r,source:o}).select().single();if(s)throw s;return a}})}function We(e=50){const{user:t}=O();return X({queryKey:["following-feed",t==null?void 0:t.id,e],queryFn:async()=>{if(!t)return[];const{data:r,error:o}=await M.from("user_follows").select("following_id").eq("follower_id",t.id);if(o)throw o;if(!r||r.length===0)return[];const a=r.map(c=>c.following_id),{data:s,error:n}=await M.from("play_history").select(`
          id,
          user_id,
          track_id,
          played_at,
          duration_ms,
          source
        `).in("user_id",a).order("played_at",{ascending:!1}).limit(e);if(n)throw n;if(!s||s.length===0)return[];const l=[...new Set(s.map(c=>c.track_id))],d=[...new Set(s.map(c=>c.user_id))],{data:p,error:h}=await M.from("tracks").select("id, title, artist, album, cover_url, preview_url, spotify_id, youtube_id").in("id",l);if(h)throw h;const{data:i,error:u}=await M.from("profiles").select("id, display_name, avatar_url").in("id",d);if(u)throw u;const w=new Map(p==null?void 0:p.map(c=>[c.id,c])),x=new Map(i==null?void 0:i.map(c=>[c.id,c]));return s.map(c=>({...c,track:w.get(c.track_id),profile:x.get(c.user_id)||{display_name:null,avatar_url:null}}))},enabled:!!t,refetchInterval:3e4})}export{Ye as P,ze as S,We as a,Xe as b,Ge as u};
