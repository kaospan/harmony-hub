import{c as z,r as i,j as e,a as m,B as y,L as $,m as f,A as T,d as ae,e as te,G as re,K as ne}from"./index-BX1-5uJX.js";import{A as ie,a as le,b as oe,f as ce}from"./formatDistanceToNow-CBRWQ1EU.js";import{P as R,S as q,a as de,b as ue,u as me}from"./useFollowing-4xm-lB-S.js";import{P as M}from"./play-DrkYy18X.js";import{g as xe,o as I}from"./providers-TqTXgJ0o.js";import{M as A}from"./music-BxcFe2bf.js";import{E as B}from"./external-link-Cr5ltfN4.js";import{P as O,E as X,f as he}from"./animations-Dk4_xDhh.js";import{U as G,a as pe}from"./BottomNav-DdksZANf.js";import{C as fe}from"./clock-Cm39k8pq.js";import"./index-BdQq_4o_.js";import"./index-BiV5K_eQ.js";import"./index-B5wY23Ui.js";import"./useQuery-GHdTcwIr.js";import"./useMutation-D6BUY7Ff.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=z("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=z("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=z("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);function ve({previewUrl:o,title:g,artist:w,coverUrl:d,isActive:u=!1,compact:r=!1,onPlay:t,onPause:c,className:j}){const a=i.useRef(null),[x,s]=i.useState(!1),[v,b]=i.useState(!1),[h,N]=i.useState(0),[p,k]=i.useState(0),[L,Q]=i.useState(.7),[_,F]=i.useState(!1),[S,C]=i.useState(null);i.useEffect(()=>{!u&&x&&V()},[u]),i.useEffect(()=>()=>{a.current&&(a.current.pause(),a.current.src="")},[]);const W=i.useCallback(async()=>{if(!(!a.current||!o)){b(!0),C(null);try{await a.current.play(),s(!0),t==null||t()}catch(n){console.error("Playback failed:",n),C("Unable to play preview")}finally{b(!1)}}},[o,t]),V=i.useCallback(()=>{a.current&&(a.current.pause(),s(!1),c==null||c())},[c]),U=()=>{x?V():W()},D=()=>{if(!a.current)return;const n=a.current.currentTime,l=a.current.duration;N(l>0?n/l*100:0)},H=()=>{a.current&&k(a.current.duration)},P=()=>{s(!1),N(0),c==null||c()},Y=n=>{if(!a.current)return;const l=n[0]/100*a.current.duration;a.current.currentTime=l,N(n[0])},Z=n=>{const l=n[0]/100;Q(l),a.current&&(a.current.volume=l),F(l===0)},ee=()=>{a.current&&(_?(a.current.volume=L,F(!1)):(a.current.volume=0,F(!0)))},E=n=>{const l=Math.floor(n/60),se=Math.floor(n%60);return`${l}:${se.toString().padStart(2,"0")}`};return o?r?e.jsxs("div",{className:m("flex items-center gap-2",j),children:[e.jsx("audio",{ref:a,src:o,preload:"none",onTimeUpdate:D,onLoadedMetadata:H,onEnded:P,onError:()=>C("Failed to load audio")}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full bg-primary/10 hover:bg-primary/20",onClick:U,disabled:v||!!S,children:v?e.jsx($,{className:"w-5 h-5 animate-spin"}):x?e.jsx(R,{className:"w-5 h-5"}):e.jsx(M,{className:"w-5 h-5 ml-0.5"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"h-1 bg-muted rounded-full overflow-hidden",children:e.jsx(f.div,{className:"h-full bg-primary",style:{width:`${h}%`},transition:{duration:.1}})})}),e.jsxs("span",{className:"text-xs text-muted-foreground tabular-nums",children:[E(h/100*p)," / ",E(p)]})]}):e.jsxs("div",{className:m("rounded-xl bg-card/50 backdrop-blur-sm p-4 space-y-3",j),children:[e.jsx("audio",{ref:a,src:o,preload:"none",onTimeUpdate:D,onLoadedMetadata:H,onEnded:P,onError:()=>C("Failed to load audio")}),e.jsxs("div",{className:"flex items-center gap-3",children:[d&&e.jsxs("div",{className:"relative w-12 h-12 rounded-lg overflow-hidden flex-shrink-0",children:[e.jsx("img",{src:d,alt:"",className:"w-full h-full object-cover"}),e.jsx(T,{children:x&&e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:e.jsx("div",{className:"flex gap-0.5",children:[0,1,2].map(n=>e.jsx(f.div,{className:"w-1 bg-white rounded-full",animate:{height:[8,16,8]},transition:{duration:.5,repeat:1/0,delay:n*.1}},n))})})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:g}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:w})]}),e.jsx(y,{variant:"default",size:"icon",className:"h-12 w-12 rounded-full flex-shrink-0",onClick:U,disabled:v||!!S,children:v?e.jsx($,{className:"w-6 h-6 animate-spin"}):x?e.jsx(R,{className:"w-6 h-6"}):e.jsx(M,{className:"w-6 h-6 ml-0.5"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{value:[h],onValueChange:Y,max:100,step:.1,className:"cursor-pointer"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground tabular-nums",children:[e.jsx("span",{children:E(h/100*p)}),e.jsx("span",{children:E(p)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ee,children:_?e.jsx(K,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"})}),e.jsx(q,{value:[_?0:L*100],onValueChange:Z,max:100,step:1,className:"w-24"})]}),S&&e.jsx("p",{className:"text-sm text-destructive",children:S})]}):e.jsxs("div",{className:m("flex items-center gap-2 text-muted-foreground text-sm",j),children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"No preview available"})]})}const J={spotify:"ðŸŽµ",youtube:"â–¶ï¸",apple_music:"ðŸŽ",deezer:"ðŸŽ§",soundcloud:"â˜ï¸",amazon_music:"ðŸ“¦"};function Ne({track:o,defaultProvider:g,onSetDefault:w,compact:d=!1,className:u}){const r=xe(o);return r.length===0?e.jsxs("div",{className:m("text-muted-foreground text-sm flex items-center gap-2",u),children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"No streaming links available"})]}):d?e.jsx("div",{className:m("flex items-center gap-2 flex-wrap",u),children:r.map(t=>e.jsxs(f.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>I(t,!1),className:m("inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-colors","hover:opacity-90",g===t.provider?"ring-2 ring-primary ring-offset-2 ring-offset-background":""),style:{backgroundColor:`${t.color}20`,color:t.color},children:[e.jsx("span",{className:"text-base",children:J[t.provider]||"ðŸŽ¶"}),e.jsx("span",{children:t.name}),e.jsx(B,{className:"w-3 h-3 opacity-60"})]},t.provider))}):e.jsxs("div",{className:m("space-y-2",u),children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"Stream on"]}),e.jsx("div",{className:"grid gap-2",children:r.map(t=>e.jsxs(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:m("flex items-center gap-3 p-3 rounded-xl transition-all","bg-muted/50 hover:bg-muted"),children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-xl",style:{backgroundColor:`${t.color}20`},children:J[t.provider]||"ðŸŽ¶"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground",children:t.name}),g===t.provider&&e.jsx("span",{className:"text-xs text-primary",children:"Default"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.appUrl&&e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>I(t,!0),title:"Open in app",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsxs(y,{variant:"secondary",size:"sm",className:"gap-1",onClick:()=>I(t,!1),children:[e.jsx(B,{className:"w-3 h-3"}),"Open"]})]})]},t.provider))})]})}function Ve(){const{user:o,loading:g}=ae(),w=te(),{data:d,isLoading:u}=de(),{data:r,isLoading:t}=ue(),c=me(),[j,a]=i.useState(null);if(g)return e.jsx(re,{fullScreen:!0});if(!o)return e.jsx(O,{title:"Following",fixedHeader:!0,children:e.jsx(X,{icon:G,title:"Sign in to see what people are listening to",description:"Follow other music lovers and discover new tracks through their listening activity.",actionLabel:"Sign in",actionIcon:pe,onAction:()=>w("/auth")})});const x=u||t;return e.jsx(O,{fixedHeader:!0,headerContent:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg font-bold gradient-text",children:"Following"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[(r==null?void 0:r.length)||0," following"]})]}),children:e.jsx("div",{className:"space-y-4",children:x?e.jsx("div",{className:"space-y-4 pt-4",children:e.jsx(ne,{count:5})}):!d||d.length===0?e.jsx(X,{icon:A,title:"No activity yet",description:r&&r.length>0?"The people you follow haven't played any tracks recently.":"Follow some music lovers to see what they're listening to!",actionLabel:!r||r.length===0?"Find people to follow":void 0,actionIcon:G,onAction:!r||r.length===0?()=>w("/search"):void 0}):e.jsx(T,{children:d.map((s,v)=>{var b,h,N,p,k;return e.jsxs(f.div,{variants:he,initial:"initial",animate:"animate",transition:{delay:v*.05},className:"rounded-xl bg-card/50 backdrop-blur-sm border border-border/50 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border/30",children:[e.jsxs(ie,{className:"w-10 h-10",children:[e.jsx(le,{src:((b=s.profile)==null?void 0:b.avatar_url)||void 0}),e.jsx(oe,{children:((p=(N=(h=s.profile)==null?void 0:h.display_name)==null?void 0:N[0])==null?void 0:p.toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:((k=s.profile)==null?void 0:k.display_name)||"Anonymous"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsx("span",{children:ce(new Date(s.played_at),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:"Played"})]})]}),s.track&&e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>a(j===s.id?null:s.id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 bg-muted",children:s.track.cover_url?e.jsx("img",{src:s.track.cover_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(A,{className:"w-8 h-8 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-foreground truncate",children:s.track.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.track.artist}),s.track.album&&e.jsx("p",{className:"text-xs text-muted-foreground/70 truncate",children:s.track.album})]}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full",onClick:L=>{L.stopPropagation(),c.mutate({trackId:s.track_id,source:"following-feed"})},children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsx(T,{children:j===s.id&&e.jsx(f.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"pt-4 space-y-4 border-t border-border/30 mt-4",children:[s.track.preview_url&&e.jsx(ve,{previewUrl:s.track.preview_url,title:s.track.title,artist:s.track.artist,coverUrl:s.track.cover_url,compact:!0}),e.jsx(Ne,{track:{spotifyId:s.track.spotify_id||void 0,youtubeId:s.track.youtube_id||void 0},compact:!0})]})})})]})]},s.id)})})})})}export{Ve as default};
