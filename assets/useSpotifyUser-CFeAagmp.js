import{c as q,f as ce,r as u,g as O,j as c,P as C,i as E,H as A,D as le,I as ue,h as de,E as fe,F as pe,a as T,m as L,s as B,d as v}from"./index-BX1-5uJX.js";import{u as j}from"./index-CEPZ7l09.js";import{R as me,h as ge,u as ye,F as he}from"./index-C8qaemdP.js";import{g as _e,o as ve}from"./providers-TqTXgJ0o.js";import{M as we}from"./music-BxcFe2bf.js";import{u as w}from"./useQuery-GHdTcwIr.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=q("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=q("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),b="harmony_hub_",z={PREFERRED_PROVIDER:`${b}preferred_provider`,VOLUME:`${b}volume`,AUTOPLAY:`${b}autoplay`,THEME:`${b}theme`,LAST_PROVIDER_USED:`${b}last_provider`};function xe(e,t){try{const r=localStorage.getItem(e);return r===null?t:JSON.parse(r)}catch{return t}}function De(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(r){console.warn("Failed to save preference:",r)}}function Re(e){De(z.PREFERRED_PROVIDER,e)}function be(){return xe(z.PREFERRED_PROVIDER,null)}var S="Dialog",[W,Je]=ce(S),[Ee,y]=W(S),V=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:o,onOpenChange:a,modal:i=!0}=e,s=u.useRef(null),d=u.useRef(null),[p,l]=de({prop:n,defaultProp:o??!1,onChange:a,caller:S});return c.jsx(Ee,{scope:t,triggerRef:s,contentRef:d,contentId:j(),titleId:j(),descriptionId:j(),open:p,onOpenChange:l,onOpenToggle:u.useCallback(()=>l(m=>!m),[l]),modal:i,children:r})};V.displayName=S;var G="DialogTrigger",K=u.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=y(G,r),a=O(t,o.triggerRef);return c.jsx(C.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":M(o.open),...n,ref:a,onClick:E(e.onClick,o.onOpenToggle)})});K.displayName=G;var N="DialogPortal",[Ce,U]=W(N,{forceMount:void 0}),Y=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:o}=e,a=y(N,t);return c.jsx(Ce,{scope:t,forceMount:r,children:u.Children.map(n,i=>c.jsx(A,{present:r||a.open,children:c.jsx(fe,{asChild:!0,container:o,children:i})}))})};Y.displayName=N;var P="DialogOverlay",H=u.forwardRef((e,t)=>{const r=U(P,e.__scopeDialog),{forceMount:n=r.forceMount,...o}=e,a=y(P,e.__scopeDialog);return a.modal?c.jsx(A,{present:n||a.open,children:c.jsx(Pe,{...o,ref:t})}):null});H.displayName=P;var Te=pe("DialogOverlay.RemoveScroll"),Pe=u.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=y(P,r);return c.jsx(me,{as:Te,allowPinchZoom:!0,shards:[o.contentRef],children:c.jsx(C.div,{"data-state":M(o.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),_="DialogContent",Q=u.forwardRef((e,t)=>{const r=U(_,e.__scopeDialog),{forceMount:n=r.forceMount,...o}=e,a=y(_,e.__scopeDialog);return c.jsx(A,{present:n||a.open,children:a.modal?c.jsx(Se,{...o,ref:t}):c.jsx(ke,{...o,ref:t})})});Q.displayName=_;var Se=u.forwardRef((e,t)=>{const r=y(_,e.__scopeDialog),n=u.useRef(null),o=O(t,r.contentRef,n);return u.useEffect(()=>{const a=n.current;if(a)return ge(a)},[]),c.jsx(J,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:E(e.onCloseAutoFocus,a=>{var i;a.preventDefault(),(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:E(e.onPointerDownOutside,a=>{const i=a.detail.originalEvent,s=i.button===0&&i.ctrlKey===!0;(i.button===2||s)&&a.preventDefault()}),onFocusOutside:E(e.onFocusOutside,a=>a.preventDefault())})}),ke=u.forwardRef((e,t)=>{const r=y(_,e.__scopeDialog),n=u.useRef(!1),o=u.useRef(!1);return c.jsx(J,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{var i,s;(i=e.onCloseAutoFocus)==null||i.call(e,a),a.defaultPrevented||(n.current||(s=r.triggerRef.current)==null||s.focus(),a.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:a=>{var d,p;(d=e.onInteractOutside)==null||d.call(e,a),a.defaultPrevented||(n.current=!0,a.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=a.target;((p=r.triggerRef.current)==null?void 0:p.contains(i))&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&o.current&&a.preventDefault()}})}),J=u.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:a,...i}=e,s=y(_,r),d=u.useRef(null),p=O(t,d);return ye(),c.jsxs(c.Fragment,{children:[c.jsx(he,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:a,children:c.jsx(le,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":M(s.open),...i,ref:p,onDismiss:()=>s.onOpenChange(!1)})}),c.jsxs(c.Fragment,{children:[c.jsx(je,{titleId:s.titleId}),c.jsx(Ae,{contentRef:d,descriptionId:s.descriptionId})]})]})}),F="DialogTitle",X=u.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=y(F,r);return c.jsx(C.h2,{id:o.titleId,...n,ref:t})});X.displayName=F;var Z="DialogDescription",ee=u.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=y(Z,r);return c.jsx(C.p,{id:o.descriptionId,...n,ref:t})});ee.displayName=Z;var te="DialogClose",re=u.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=y(te,r);return c.jsx(C.button,{type:"button",...n,ref:t,onClick:E(e.onClick,()=>o.onOpenChange(!1))})});re.displayName=te;function M(e){return e?"open":"closed"}var oe="DialogTitleWarning",[Xe,ne]=ue(oe,{contentName:_,titleName:F,docsSlug:"dialog"}),je=({titleId:e})=>{const t=ne(oe),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return u.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},Oe="DialogDescriptionWarning",Ae=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ne(Oe).contentName}}.`;return u.useEffect(()=>{var a;const o=(a=e.current)==null?void 0:a.getAttribute("aria-describedby");t&&o&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},Ze=V,et=K,tt=Y,rt=H,ot=Q,nt=X,at=ee,st=re;const Ne=({className:e})=>c.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),Fe=({className:e})=>c.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})});function it({track:e,className:t,size:r="md"}){const n=_e(e),o=n.find(l=>l.provider==="spotify"),a=n.find(l=>l.provider==="youtube"),i=be(),s=(l,m)=>{l&&(Re(m),ve(l,m==="spotify"))},d={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12"},p={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return!o&&!a?c.jsxs("div",{className:T("flex items-center gap-2 text-muted-foreground",t),children:[c.jsx(we,{className:"w-4 h-4"}),c.jsx("span",{className:"text-sm",children:"No streaming links"})]}):c.jsxs("div",{className:T("flex items-center gap-2",t),children:[o&&c.jsx(L.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>s(o,"spotify"),className:T(d[r],"rounded-full flex items-center justify-center transition-all","bg-[#1DB954] hover:bg-[#1ed760] text-white shadow-lg",i==="spotify"&&"ring-2 ring-white ring-offset-2 ring-offset-background"),title:"Open in Spotify",children:c.jsx(Ne,{className:p[r]})}),a&&c.jsx(L.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>s(a,"youtube"),className:T(d[r],"rounded-full flex items-center justify-center transition-all","bg-[#FF0000] hover:bg-[#cc0000] text-white shadow-lg",i==="youtube"&&"ring-2 ring-white ring-offset-2 ring-offset-background"),title:"Open on YouTube",children:c.jsx(Fe,{className:p[r]})})]})}const x="https://api.spotify.com/v1",Me="https://accounts.spotify.com/api/token";async function ae(e){const{data:t,error:r}=await B.from("user_providers").select("*").eq("user_id",e).eq("provider","spotify").single();return r||!t?null:t}async function se(e,t){const r="b1d936a5b2bd4cb199d3ede9a4fa2449";try{const n=await fetch(Me,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:t,client_id:r})});if(!n.ok)return console.error("Failed to refresh Spotify token:",n.status),null;const o=await n.json(),a=new Date(Date.now()+o.expires_in*1e3).toISOString();return await B.from("user_providers").update({access_token:o.access_token,expires_at:a,...o.refresh_token&&{refresh_token:o.refresh_token}}).eq("user_id",e).eq("provider","spotify"),o.access_token}catch(n){return console.error("Error refreshing Spotify token:",n),null}}async function D(e){const t=await ae(e);if(!t)return null;const r=new Date(t.expires_at),n=new Date,o=5*60*1e3;return r.getTime()-n.getTime()<o?await se(e,t.refresh_token):t.access_token}function Ie(e){const{track:t}=e,r=t.album.images.sort((n,o)=>o.height-n.height)[0];return{id:`spotify:${t.id}`,title:t.name,artist:t.artists.map(n=>n.name).join(", "),artists:t.artists.map(n=>n.name),album:t.album.name,cover_url:r==null?void 0:r.url,artwork_url:r==null?void 0:r.url,duration_ms:t.duration_ms,spotify_id:t.id,url_spotify_web:t.external_urls.spotify,url_spotify_app:t.uri,preview_url:t.preview_url,provider:"spotify",external_id:t.id}}async function ie(e,t=20){const r=await D(e);if(!r)return null;try{const n=new URLSearchParams({limit:Math.min(t,50).toString()}),o=await fetch(`${x}/me/player/recently-played?${n}`,{headers:{Authorization:`Bearer ${r}`}});return o.ok?{tracks:(await o.json()).items.map(Ie),source:"spotify"}:o.status===401?await se(e,"")?ie(e,t):(console.error("Spotify token refresh failed"),null):(console.error("Failed to fetch recently played:",o.status),null)}catch(n){return console.error("Error fetching recently played:",n),null}}async function $e(e){return await ae(e)!==null}async function Le(e){var r,n,o;const t=await D(e);if(!t)return null;try{const a=await fetch(`${x}/me`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)return null;const i=await a.json();return{displayName:i.display_name||i.id,email:i.email,imageUrl:(n=(r=i.images)==null?void 0:r[0])==null?void 0:n.url,product:i.product,followers:(o=i.followers)==null?void 0:o.total}}catch(a){return console.error("Error fetching Spotify profile:",a),null}}async function I(e,t="medium_term",r=20){const n=await D(e);if(!n)return[];try{const o=new URLSearchParams({time_range:t,limit:Math.min(r,50).toString()}),a=await fetch(`${x}/me/top/tracks?${o}`,{headers:{Authorization:`Bearer ${n}`}});return a.ok?(await a.json()).items.map(s=>{var d,p;return{id:`spotify:${s.id}`,title:s.name,artist:s.artists.map(l=>l.name).join(", "),artists:s.artists.map(l=>l.name),album:s.album.name,cover_url:(d=s.album.images[0])==null?void 0:d.url,artwork_url:(p=s.album.images[0])==null?void 0:p.url,duration_ms:s.duration_ms,spotify_id:s.id,provider:"spotify",external_id:s.id}}):[]}catch(o){return console.error("Error fetching top tracks:",o),[]}}async function $(e,t="medium_term",r=20){const n=await D(e);if(!n)return[];try{const o=new URLSearchParams({time_range:t,limit:Math.min(r,50).toString()}),a=await fetch(`${x}/me/top/artists?${o}`,{headers:{Authorization:`Bearer ${n}`}});return a.ok?(await a.json()).items:[]}catch(o){return console.error("Error fetching top artists:",o),[]}}async function qe(e,t){if(t.length===0)return[];const r=await D(e);if(!r)return[];try{const n=t.slice(0,100).join(","),o=await fetch(`${x}/audio-features?ids=${n}`,{headers:{Authorization:`Bearer ${r}`}});return o.ok?(await o.json()).audio_features.filter(Boolean):[]}catch(n){return console.error("Error fetching audio features:",n),[]}}async function Be(e){const[t,r]=await Promise.all([I(e,"medium_term",50),$(e,"medium_term",50)]);if(t.length===0)return null;const n=t.map(f=>f.spotify_id||f.external_id).filter(Boolean),o=await qe(e,n);if(o.length===0)return null;const a=o.reduce((f,g)=>f+g.energy,0)/o.length,i=o.reduce((f,g)=>f+g.danceability,0)/o.length,s=o.reduce((f,g)=>f+g.valence,0)/o.length,d=o.reduce((f,g)=>f+g.tempo,0)/o.length,p={};r.forEach(f=>{f.genres.forEach(g=>{p[g]=(p[g]||0)+1})});const l=Object.entries(p).sort((f,g)=>g[1]-f[1]).slice(0,10).map(([f,g])=>({genre:f,count:g}));let m="balanced";a>.7&&s>.6?m="energetic":a<.4&&s>.5?m="chill":s<.35?m="melancholic":s>.65&&i>.6&&(m="upbeat");const h=new Set(t.flatMap(f=>f.artists||[])),R=Math.min(h.size/t.length,1);return{topGenres:l,averageEnergy:a,averageDanceability:i,averageValence:s,averageTempo:d,moodProfile:m,listeningDiversity:R}}async function ze(e,t=[],r=[],n=20){const o=await D(e);if(!o)return[];try{let a=t,i=r;if(a.length===0&&i.length===0){const[l,m]=await Promise.all([I(e,"medium_term",5),$(e,"medium_term",5)]);a=l.slice(0,2).map(h=>h.spotify_id||h.external_id).filter(Boolean),i=m.slice(0,3).map(h=>h.id)}const s=[];if(a.length>0&&s.push(`seed_tracks=${a.slice(0,2).join(",")}`),i.length>0&&s.push(`seed_artists=${i.slice(0,3).join(",")}`),s.length===0)return[];const d=await fetch(`${x}/recommendations?${s.join("&")}&limit=${n}`,{headers:{Authorization:`Bearer ${o}`}});return d.ok?(await d.json()).tracks.map(l=>{var m,h;return{id:`spotify:${l.id}`,title:l.name,artist:l.artists.map(R=>R.name).join(", "),artists:l.artists.map(R=>R.name),album:l.album.name,cover_url:(m=l.album.images[0])==null?void 0:m.url,artwork_url:(h=l.album.images[0])==null?void 0:h.url,duration_ms:l.duration_ms,spotify_id:l.id,provider:"spotify",external_id:l.id}}):[]}catch(a){return console.error("Error fetching recommendations:",a),[]}}function k(){const{user:e}=v();return w({queryKey:["spotify-connected",e==null?void 0:e.id],queryFn:()=>$e(e.id),enabled:!!e,staleTime:5*60*1e3})}function ct(e=20){const{user:t}=v();return w({queryKey:["spotify-recently-played",t==null?void 0:t.id,e],queryFn:()=>ie(t.id,e),enabled:!!t,staleTime:2*60*1e3,refetchOnWindowFocus:!0})}function lt(){const{user:e}=v();return w({queryKey:["spotify-profile",e==null?void 0:e.id],queryFn:()=>Le(e.id),enabled:!!e,staleTime:10*60*1e3})}function ut(e="medium_term",t=20){const{user:r}=v(),{data:n}=k();return w({queryKey:["spotify-top-tracks",r==null?void 0:r.id,e,t],queryFn:()=>I(r.id,e,t),enabled:!!r&&n===!0,staleTime:10*60*1e3})}function dt(e="medium_term",t=20){const{user:r}=v(),{data:n}=k();return w({queryKey:["spotify-top-artists",r==null?void 0:r.id,e,t],queryFn:()=>$(r.id,e,t),enabled:!!r&&n===!0,staleTime:10*60*1e3})}function ft(){const{user:e}=v(),{data:t}=k();return w({queryKey:["music-stats",e==null?void 0:e.id],queryFn:()=>Be(e.id),enabled:!!e&&t===!0,staleTime:30*60*1e3})}function pt(e=[],t=[],r=20){const{user:n}=v(),{data:o}=k();return w({queryKey:["spotify-recommendations",n==null?void 0:n.id,e,t,r],queryFn:()=>ze(n.id,e,t,r),enabled:!!n&&o===!0,staleTime:15*60*1e3})}export{He as B,ot as C,at as D,rt as O,tt as P,it as Q,Ze as R,Ne as S,nt as T,st as a,et as b,Qe as c,k as d,lt as e,ut as f,dt as g,ft as h,pt as i,ct as u};
